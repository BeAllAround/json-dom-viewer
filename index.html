<head>

<style>

.selector {
	color: white;
}

</style>

</head>

<body>
	<input type="file" id="file-selector" class="selector" multiple>
	<br/>
</body>

<script type="module">
	import viewer from './dist/viewer.js'
	
	function textDiv(text) {
	  let div = document.createElement('div')
	  div.textContent = text
	  Object.assign(div.style, {color: 'white',})
	  return div
	}

	function readJson(file) {
          const reader = new FileReader();
	  if(file.type !== 'application/json') {
	    alert('Not a json file!')
	    throw new Error('Not a json file!')
	  }
	  // console.log('type: ', [file.type])
	  return new Promise((resolve, reject) => {
            reader.addEventListener('load', event => {
              let result = event.target.result;
	      resolve(result)
	      // console.log('read: ', read)
            });
            reader.readAsText(file);
	  })
        }

	const fileSelector = document.querySelector('#file-selector')
	fileSelector.addEventListener('change', event => {
          let files = event.target.files
	  for(let file of files) {
	    readJson(file).then(model=>{
	      document.body.appendChild(document.createElement('br'))
	      document.body.appendChild(textDiv(file.name))
	      document.body.appendChild(
                viewer.viewJSONAsString(model)
	      )
	    })
	  }

	})

	Object.assign(document.body.style, {'background-color': '#1f2023'})
</script>
